---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout>
  <article class="min-h-screen pb-40">
    
    <!-- HEADER -->
    <header class="h-[60vh] flex flex-col justify-end px-6 pb-12 relative border-b border-white/10">
      <div class="max-w-7xl mx-auto w-full">
        <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
          <div>
            <span class="text-sunset font-mono tracking-widest uppercase text-sm mb-4 block reveal-text">
              {post.data.service} â€” {post.data.date}
            </span>
            <h1 class="text-5xl md:text-8xl font-display font-bold text-white leading-[0.9] reveal-text" transition:name={`title-${post.slug}`}>
              {post.data.client}
            </h1>
            <h2 class="text-2xl md:text-3xl text-white/50 mt-4 font-light reveal-text">{post.data.title}</h2>
          </div>
          
          <!-- Team Credits (Right Side) -->
          {post.data.roles && (
            <div class="reveal-text text-right md:text-left">
              <h3 class="text-white/30 text-xs font-mono uppercase tracking-widest mb-2">The Team</h3>
              <ul class="text-sm text-gray-300 space-y-1">
                {post.data.roles.map(role => <li>{role}</li>)}
              </ul>
            </div>
          )}
        </div>
      </div>
    </header>

    <!-- VIDEO SECTION -->
    {post.data.youtubeId && (
      <div class="w-full bg-black py-10">
        <div class="max-w-6xl mx-auto aspect-video shadow-2xl shadow-sunset/10">
          <iframe 
            class="w-full h-full"
            src={`https://www.youtube.com/embed/${post.data.youtubeId}?theme=dark&color=white&rel=0`} 
            title="YouTube video player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
          ></iframe>
        </div>
      </div>
    )}

    <!-- CONTENT -->
    <div class="max-w-3xl mx-auto px-6 font-body text-lg text-gray-300 leading-relaxed space-y-8 blog-content mt-20">
      <Content />
    </div>

  </article>

  <!-- Script remains the same -->
  <script>
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';
    
    document.addEventListener('astro:page-load', () => {
      gsap.registerPlugin(ScrollTrigger);
      const tl = gsap.timeline();
      tl.from(".reveal-text", {
        y: 50,
        opacity: 0,
        duration: 1,
        stagger: 0.1,
        ease: "power4.out"
      });
    });
  </script>
</Layout>

<style is:global>
  .blog-content h2 {
    font-family: var(--font-display);
    font-size: 2rem;
    color: white;
    margin-top: 3rem;
  }
  .blog-content strong { color: white; }
  .blog-content ul { list-style-type: disc; padding-left: 1.5rem; margin-top: 1rem; }
</style>